var watchingContent=new function(){var e=new(Object.setPrototypeOf($.extend(function(e){JsonCache.call(this,e)}.prototype,{save:function(){var e=this.get();e.data.viewer.works.nodes.sort(function(e,t){return new TitleNormalizer(e).compare(new TitleNormalizer(t))}),e.episodeAnnictIds=[],e.data.viewer.works.nodes.forEach(function(t){var i=t.episodes.nodes;i.length>0&&e.episodeAnnictIds.push(i[0].annictId)}),JsonCache.prototype.save.call(this)},getDefault:function(){return{data:{viewer:{works:{nodes:[]}}},episodeAnnictIds:[],version:version}}}),JsonCache.prototype).constructor)("watchingWorks"),t=null,i=function(e){var i=annict.makeWorkPageUrl(e.annictId),n=t.find(".work-heading").clone(!0,!0);return n.removeData().attr("data-id",e.id).attr("data-annict-id",e.annictId),n.find(".work-link").attr("href",i).text(e.title),n},n=function(e,i){var n=t.find(".episode-body").clone(!0,!0);if(!e)return n.empty();n.removeData().attr("data-id",e.id).attr("data-annict-id",e.annictId);var o=annict.makeEpisodePageUrl(i.annictId,e.annictId),r=n.find(".episode-record"),a=n.find(".episode-title").text(e.title?e.title:"");return n.find(".episode-link").attr("href",o),n.find(".episode-number").text(e.numberText?e.numberText:"--"),e.viewerDidTrack?r.attr("disabled","disabled"):a.hide(),n},o=[{title:"あ",initial:"A",reg:/^[ぁ-お]/,works:[]},{title:"か",initial:"K",reg:/^[か-ご]/,works:[]},{title:"さ",initial:"S",reg:/^[さ-ぞ]/,works:[]},{title:"た",initial:"T",reg:/^[た-ど]/,works:[]},{title:"な",initial:"N",reg:/^[な-の]/,works:[]},{title:"は",initial:"H",reg:/^[は-ぽ]/,works:[]},{title:"ま",initial:"M",reg:/^[ま-も]/,works:[]},{title:"や",initial:"Y",reg:/^[ゃ-よ]/,works:[]},{title:"ら",initial:"R",reg:/^[ら-ろ]/,works:[]},{title:"わ",initial:"W",reg:/^[ゎ-ん]/,works:[]},{title:"他",initial:"O",reg:/^./,works:[]}],r=function(){e.get().data.viewer.works.nodes.forEach(function(e){for(var t=new TitleNormalizer(e),i=0;i<o.length;i++)if(o[i].reg.test(t.getKana())){o[i].works.push(e);break}});var r=$("#watching-works").empty();o.forEach(function(e){var o=e.works.length>0;if(headerContent.toggleInitial(e.initial,o),o){var a=t.find(".group-heading, .group-body").clone(!1,!1),d=a.find(".works");for(a.filter(".group-heading").attr("data-initial",e.initial),a.find(".group-title").text(e.title),d.empty(),r.append(a);e.works.length>0;){var s=e.works.shift(),c=s.episodes.nodes.length>0?s.episodes.nodes[0]:null,l=i(s),f=n(c,s);d.append(l,f)}}}),headerContent.updateBodyTop()},a=function(t,i){for(var o=i.filter(".work-heading").data("annict-id"),r=e.get(),a=r.data.viewer.works.nodes,d=0;d<a.length;d++)if(a[d].annictId==o){a[d].episodes.nodes[0]=t,e.set(r);var s=n(t,a[d]);i.filter(".episode-body").remove(),i.filter(".work-heading").after(s);break}},d=function(t){annict.watchingWorks(function(i){if(i.data.searchEpisodes){var n=i.data.viewer.works.nodes;i.data.searchEpisodes.nodes.forEach(function(e){for(var t=e.work.annictId,i=0;i<n.length;i++)if(n[i].annictId==t){delete e.work,n[i].episodes.nodes=[e];break}}),delete i.data.searchEpisodes}e.set(i),t()},e.get().episodeAnnictIds)},s=function(t){!function(t){for(var i=e.get(),n=i.data.viewer.works.nodes,o=0;o<n.length;o++)if(n[o].id==t)return n.splice(o,1),e.set(i),!0}(t);var i=$('#watching-works .work-heading[data-id="'+t+'"]');if(0!=i.length){var n=i.closest(".works");if(i.next(".episode-body").remove(),i.remove(),0==n.find(".work-heading").length){var o=n.closest(".group-body"),r=o.prev(".group-heading"),a=r.data("initial");r.remove(),o.remove(),headerContent.toggleInitial(a,!1),headerContent.updateBodyTop()}}},c=function(e,t,i,n){e.on("click",function(){var e=$(this).closest(".episode-body").prev(".work-heading").addBack(),o=e.filter(".episode-body").data("annict-id");t(function(t){var n=t.data.searchEpisodes.nodes;if(n&&0!=n.length){var o=function(e,t){var i=e[t];if(i){for(;i[t];)i=i[t];return i}return e.work.episodes.nodes[0]}(n[0],i);a(o,e)}},o,n)})},l=function(e,t,i){e.on("click",function(){var e=$(this).closest(".work-heading"),n=e.data("id"),o=e.find(".work-link").attr("href"),r=e.find(".work-link").text();dialogContent.updateStatusDialog.display(function(e,t){s(e),searchContent.updateWorkStatus(e,t)},t,i,o,r,n)})},f=function(){l(t.find(".work-watched"),"WATCHED","見た"),l(t.find(".work-hold"),"ON_HOLD","一時中断"),l(t.find(".work-stop"),"STOP_WATCHING","視聴中止"),t.find(".work-review").on("click",function(){var e=$(this).closest(".work-heading"),t=e.find(".work-link").attr("href"),i=e.find(".work-link").text(),n=e.data("id");dialogContent.createReviewDialog.display(t,i,n)}),function(e){e.on("click",function(){var e=$(this).closest(".episode-body").prev(".work-heading").addBack(),t=e.find(".work-link").attr("href"),i=e.find(".work-link").text(),n=e.find(".episode-link").attr("href"),o=e.find(".episode-number").text(),r=e.find(".episode-title").text(),d=e.filter(".episode-body").data("id");dialogContent.createRecordDialog.display(function(t){var i=t.data.createRecord.record.episode;a(i,e)},t,i,n,o,r,d)})}(t.find(".episode-record")),c(t.find(".episode-skip-prev"),annict.prevEpisode,"prevEpisode",!0),c(t.find(".episode-prev"),annict.prevEpisode,"prevEpisode",!1),c(t.find(".episode-next"),annict.nextEpisode,"nextEpisode",!1),c(t.find(".episode-skip-next"),annict.nextEpisode,"nextEpisode",!0),$("#update").on("click",function(){d(function(){r(),headerContent.inform("更新しました。","info")})}),$("#clear").on("click",function(){StorageCache.clear(),watchingContent.clear(),searchContent.clear(),headerContent.inform("クリアしました。","info")})};this.addWork=function(t){(function(t){for(var i=e.get(),n=i.data.viewer.works.nodes,o=0;o<n.length;o++)if(n[o].annictId==t.annictId)return!1;return n.push(t),e.set(i),!0})(t)&&r()},this.removeWork=s,this.getGroups=function(){return o},this.getGroupTop=function(e){var t=$("#watching-works"),i=t.find(".group-heading:first").offset().top;return t.find('.group-heading[data-initial="'+e+'"]').offset().top-i},this.clear=function(){e.remove(),r()},this.build=function(){t=$("#watching-template"),f(),e.get().version!=version?d(function(){r()}):r()}};$(function(){watchingContent.build()});
//# sourceMappingURL=watching.min.js.map