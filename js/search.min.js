var searchContent=new function(){var t=new(Object.setPrototypeOf($.extend(function(t){JsonCache.call(this,t)}.prototype,{getDefault:function(){return{data:{searchWorks:{nodes:[],pageInfo:{hasPreviousPage:!1,hasNextPage:!1}}},title:"",version:version}}}),JsonCache.prototype).constructor)("searchWorks"),a=null,e=function(){var e=t.get();$("#title").val(e.title);var n=a.find(".works").clone(!1,!1);n.empty(),$("#result-works").empty().append(n),e.data.searchWorks.nodes.forEach(function(t){var e=a.find(".work-heading").clone(!0,!0);e.removeData().attr("data-id",t.id).attr("data-annict-id",t.annictId);var r=annict.makeWorkPageUrl(t.annictId);e.find(".work-link").attr("href",r).text(t.title),e.find(".work-status").val(t.viewerStatusState),n.append(e)}),$("#pager-prev").toggle(e.data.searchWorks.pageInfo.hasPreviousPage),$("#pager-next").toggle(e.data.searchWorks.pageInfo.hasNextPage)},n=function(a,n){var r=$("#title").val().trim();annict.searchWorks(function(o){a&&(o.data.searchWorks.pageInfo.hasNextPage=!0),n&&(o.data.searchWorks.pageInfo.hasPreviousPage=!0),o.title=r,t.set(o),e(),0==o.data.searchWorks.nodes.length&&headerContent.inform("作品が見つかりませんでした。","warning")},r,a,n)},r=function(a,e){for(var n=t.get(),r=n.data.searchWorks.nodes,o=0;o<r.length;o++)if(r[o].id==a){r[o].viewerStatusState=e,t.set(n),$('#result-works .work-heading[data-id="'+a+'"] .work-status').val(e);break}},o=function(){t.remove(),e()};this.build=function(){a=$("#search-template"),$("#search-form").submit(function(){return n(null,null),!1}),$("#search").click(function(){$(this).blur(),$("#search-form").submit()}),$("#remove").click(function(){$(this).blur(),o()}),a.find(".work-status").change(function(){var t=$(this),a=t.val(),e=t.closest(".work-heading").data("id");annict.updateStatus(function(t){var n=t.data.updateStatus.work;"WATCHING"==a?watchingContent.addWork(n):watchingContent.removeWork(e),r(e,a),headerContent.inform("変更しました。","info")},e,a)}),$("#pager-prev a").click(function(){$(this).blur(),$(window).scrollTop(0),n(t.get().data.searchWorks.pageInfo.startCursor,null)}),$("#pager-next a").click(function(){$(this).blur(),$(window).scrollTop(0),n(null,t.get().data.searchWorks.pageInfo.endCursor)}),a.find(".work-review").click(function(){var t=$(this).closest(".work-heading"),a=t.find(".work-link").attr("href"),e=t.find(".work-link").text(),n=t.data("id");dialogContent.createReviewDialog.display(a,e,n)}),e()},this.updateWorkStatus=r,this.clear=o};$(function(){searchContent.build()});