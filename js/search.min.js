var searchContent=new function(){var t=new(Object.setPrototypeOf($.extend(function(t){JsonCache.call(this,t)}.prototype,{getDefault:function(){return{data:{searchWorks:{nodes:[],pageInfo:{hasPreviousPage:!1,hasNextPage:!1}}},title:"",version:version}}}),JsonCache.prototype).constructor)("searchWorks"),e=null,a=function(){var a=t.get();$("#title").val(a.title);var n=e.find(".works").clone(!1,!1);n.empty(),$("#result-works").empty().append(n),a.data.searchWorks.nodes.forEach(function(t){var a=e.find(".work-heading").clone(!0,!0);a.removeData().attr("data-id",t.id).attr("data-annict-id",t.annictId);var r=annict.makeWorkPageUrl(t.annictId);a.find(".work-link").attr("href",r).text(t.title),a.find(".work-status").val(t.viewerStatusState),n.append(a)}),$("#pager-prev").toggle(a.data.searchWorks.pageInfo.hasPreviousPage),$("#pager-next").toggle(a.data.searchWorks.pageInfo.hasNextPage)},n=function(e,n){var r=$("#title").val().trim();annict.searchWorks(function(o){e&&(o.data.searchWorks.pageInfo.hasNextPage=!0),n&&(o.data.searchWorks.pageInfo.hasPreviousPage=!0),o.title=r,t.set(o),a(),0==o.data.searchWorks.nodes.length&&headerContent.inform("作品が見つかりませんでした。","warning")},r,e,n)},r=function(e,a){for(var n=t.get(),r=n.data.searchWorks.nodes,o=0;o<r.length;o++)if(r[o].id==e){r[o].viewerStatusState=a,t.set(n),$('#result-works .work-heading[data-id="'+e+'"] .work-status').val(a);break}},o=function(){t.remove(),a()};this.build=function(){e=$("#search-template"),$("#search-form").on("submit",function(){return n(null,null),!1}),$("#search").on("click",function(){$(this).trigger("blur"),$("#search-form").trigger("submit")}),$("#remove").on("click",function(){$(this).trigger("blur"),o()}),e.find(".work-status").on("change",function(){var t=$(this),e=t.val(),a=t.closest(".work-heading").data("id");annict.updateStatus(function(t){var n=t.data.updateStatus.work;"WATCHING"==e?watchingContent.addWork(n):watchingContent.removeWork(a),r(a,e),headerContent.inform("変更しました。","info")},a,e)}),$("#pager-prev a").on("click",function(){$(this).trigger("blur"),$(window).scrollTop(0),n(t.get().data.searchWorks.pageInfo.startCursor,null)}),$("#pager-next a").on("click",function(){$(this).trigger("blur"),$(window).scrollTop(0),n(null,t.get().data.searchWorks.pageInfo.endCursor)}),e.find(".work-review").on("click",function(){var t=$(this).closest(".work-heading"),e=t.find(".work-link").attr("href"),a=t.find(".work-link").text(),n=t.data("id");dialogContent.createReviewDialog.display(e,a,n)}),a()},this.updateWorkStatus=r,this.clear=o};$(function(){searchContent.build()});
//# sourceMappingURL=search.min.js.map