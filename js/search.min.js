var searchContent=new function(){var t=new(Object.setPrototypeOf($.extend(function(t){JsonCache.call(this,t)}.prototype,{getDefault:function(){return{data:{searchWorks:{nodes:[],pageInfo:{hasPreviousPage:!1,hasNextPage:!1}}},title:"",version:version}}}),JsonCache.prototype).constructor)("searchWorks"),a=function(){var a=t.get();$("#title").val(a.title);var e=$("#works-template .works").clone(!1,!1);e.empty(),$("#result-works").empty().append(e),a.data.searchWorks.nodes.forEach(function(t){var a=$("#works-template .work-heading").clone(!0,!0);a.removeData().attr("data-id",t.id).attr("data-annict-id",t.annictId);var r="https://annict.jp/works/"+t.annictId;a.find(".work-link").attr("href",r).text(t.title),a.find(".work-status").val(t.viewerStatusState),e.append(a)}),$("#pager-prev").toggle(a.data.searchWorks.pageInfo.hasPreviousPage),$("#pager-next").toggle(a.data.searchWorks.pageInfo.hasNextPage)},e=function(e,r){var n=$("#title").val().trim();api.searchWorks(function(o){e&&(o.data.searchWorks.pageInfo.hasNextPage=!0),r&&(o.data.searchWorks.pageInfo.hasPreviousPage=!0),o.title=n,t.set(o),t.save(),a(),0==o.data.searchWorks.nodes.length&&headerContent.inform("作品が見つかりませんでした。","warning")},n,e,r)},r=function(a,e){for(var r=t.get().data.searchWorks.nodes,n=0;n<r.length;n++)if(r[n].id==a){r[n].viewerStatusState=e,t.save(),$('#result-works .work-heading[data-id="'+a+'"] .work-status').val(e);break}},n=function(){t.remove(),a()};this.build=function(){$("#searchForm").submit(function(){return e(null,null),!1}),$("#search").click(function(){$(this).blur(),$("#searchForm").submit()}),$("#remove").click(function(){$(this).blur(),n()}),$("#works-template .work-status").change(function(){var t=$(this),a=t.val(),e=t.closest(".work-heading").data("id");api.updateStatus(function(t){var n=t.data.updateStatus.work;"WATCHING"==a?watchingContent.addWork(n):watchingContent.removeWork(e),r(e,a),headerContent.inform("変更しました。","info")},e,a)}),$("#pager-prev a").click(function(){$(this).blur(),$(window).scrollTop(0),e(t.get().data.searchWorks.pageInfo.startCursor,null)}),$("#pager-next a").click(function(){$(this).blur(),$(window).scrollTop(0),e(null,t.get().data.searchWorks.pageInfo.endCursor)}),a()},this.updateWorkStatus=r,this.clear=n};$(function(){searchContent.build()});