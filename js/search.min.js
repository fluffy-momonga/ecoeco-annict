var searchWorksJsonCache=new(Object.setPrototypeOf($.extend(function(e){JsonCache.call(this,e)}.prototype,{getDefault:function(){return{data:{searchWorks:{nodes:[],pageInfo:{hasPreviousPage:!1,hasNextPage:!1}}},title:"",version:version}}}),JsonCache.prototype).constructor)("searchWorks");function renderSearchWorks(){var e=searchWorksJsonCache.get();$("#title").val(e.title);var a=$("#works-template .works").clone(!1,!1);a.empty(),$("#result-works").empty().append(a),e.data.searchWorks.nodes.forEach(function(e){var r=$("#works-template .work-heading").clone(!0,!0);r.removeData().attr("data-id",e.id).attr("data-annict-id",e.annictId);var t="https://annict.jp/works/"+e.annictId;r.find(".work-link").attr("href",t).text(e.title),r.find(".work-status").val(e.viewerStatusState),a.append(r)}),$("#pager-prev").toggle(e.data.searchWorks.pageInfo.hasPreviousPage),$("#pager-next").toggle(e.data.searchWorks.pageInfo.hasNextPage)}function searchWorks(e,a){var r=$("#title").val().trim();api.searchWorks(function(e){e.title=r,searchWorksJsonCache.set(e),searchWorksJsonCache.save(),renderSearchWorks(),0==e.data.searchWorks.nodes.length&&alertMessage("対象の作品が見つかりませんでした。","warning")},r,e,a)}$(function(){$("#searchForm").submit(function(){return searchWorks(null,null),!1}),$("#search").click(function(){$(this).blur(),$("#searchForm").submit()}),$("#remove").click(function(){$(this).blur(),searchWorksJsonCache.remove(),renderSearchWorks()}),$("#works-template .work-status").change(function(){var e=$(this),a=e.val(),r=e.closest(".work-heading").data("id");api.updateStatus(function(e){var r=e.data.updateStatus.work;("WATCHING"==a?addWatchingWorksJson(r):removeWatchingWorksJson(r.annictId))&&renderWatchingWorks(),alertMessage("変更完了","info")},r,a)}),$("#pager-prev a").click(function(){$(this).blur(),$(window).scrollTop(0),searchWorks(searchWorksJsonCache.get().data.searchWorks.pageInfo.startCursor,null)}),$("#pager-next a").click(function(){$(this).blur(),$(window).scrollTop(0),searchWorks(null,searchWorksJsonCache.get().data.searchWorks.pageInfo.endCursor)}),renderSearchWorks()});