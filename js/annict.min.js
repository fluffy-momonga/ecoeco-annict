var annict=new function(){var e="annict.com",t="https://api."+e+"/graphql",i=20,s=/[\s　]+/g,a=new StorageCache("token"),n="id annictId title titleKana ",r="id annictId numberText title viewerDidTrack ",o="query($episodeAnnictIds: [Int!], $withEpisodes: Boolean!) { viewer { works(state: WATCHING) { nodes { "+n+"episodes(orderBy: {field: SORT_NUMBER, direction: ASC}, first: 1) { nodes { "+r+"} } } } } searchEpisodes(annictIds: $episodeAnnictIds) @include(if: $withEpisodes) { nodes { "+r+"work { annictId } } } }",d="query($id: Int!, $skip: Boolean!) { searchEpisodes(annictIds: [$id]) { nodes { nextEpisode { ...episodeFields nextEpisode @include(if: $skip) { ...episodeFields nextEpisode { ...episodeFields nextEpisode { ...episodeFields nextEpisode { ...episodeFields } } } } } work { episodes(orderBy: {field: SORT_NUMBER, direction: ASC}, first: 1) { nodes { ...episodeFields } } } } } } fragment episodeFields on Episode { "+r+"}",p="query($id: Int!, $skip: Boolean!) { searchEpisodes(annictIds: [$id]) { nodes { prevEpisode { ...episodeFields prevEpisode @include(if: $skip) { ...episodeFields prevEpisode { ...episodeFields prevEpisode { ...episodeFields prevEpisode { ...episodeFields } } } } } work { episodes(orderBy: {field: SORT_NUMBER, direction: DESC}, first: 1) { nodes { ...episodeFields } } } } } } fragment episodeFields on Episode { "+r+"}",c="mutation($id: ID!, $rating: RatingState, $comment: String) { createRecord(input: {episodeId: $id, ratingState: $rating, comment: $comment}) { record { episode { "+r+"} } } }",l="mutation($id: ID!, $body: String!, $overall: RatingState, $animation: RatingState, $music: RatingState, $story: RatingState, $character: RatingState) { createReview(input: {workId: $id, body: $body, ratingOverallState: $overall, ratingAnimationState: $animation, ratingMusicState: $music, ratingStoryState: $story, ratingCharacterState: $character}) { review { work { title } } } }",u="mutation($id: ID!, $state: StatusState!) { updateStatus(input: {workId: $id, state: $state}) { work { "+n+"episodes(first: 1, orderBy: {field: SORT_NUMBER, direction: ASC}) { nodes { "+r+"} } } } } ",g="query($titles: [String!]!, $before: String, $after: String, $first: Int, $last: Int) { searchWorks(titles: $titles, orderBy: {field: SEASON, direction: DESC}, before: $before, after: $after, first: $first, last: $last) { nodes { "+n+"viewerStatusState } pageInfo { startCursor endCursor hasPreviousPage hasNextPage } } }",h=function(t){return"https://"+e+"/works/"+t},f=function(t,i){return"https://"+e+"/works/"+t+"/episodes/"+i},S=function(e){var t="";if(e.responseText){t=": ";try{var i=JSON.parse(e.responseText);i.message&&(t+=i.message)}catch(i){t+=e.responseText}}headerContent.inform("Graphql API のリクエストでエラーが発生しました。 ("+e.status+t+")","danger",5e3)},k=function(e,i,a,n){var r={query:i.replace(s," ")};a&&(r.variables=a),$.ajax({url:t,type:"POST",contentType:"application/json",dataType:"json",headers:{Authorization:"bearer "+n},data:JSON.stringify(r),success:e,error:S})},m=function(e,t,i){var s=a.useLocalStorage().get();s||(s=a.useSessionStorage().get()),s?k(e,t,i,s):dialogContent.inputTokenDialog.display(function(s,n){k(function(t){"session"==s?a.useSessionStorage().set(n):"local"==s&&a.useLocalStorage().set(n),e(t)},t,i,n)})};this.watchingWorks=function(e,t){var i={episodeAnnictIds:t,withEpisodes:t.length>0};m(e,o,i)},this.prevEpisode=function(e,t,i){m(e,p,{id:t,skip:i})},this.nextEpisode=function(e,t,i){m(e,d,{id:t,skip:i})},this.createReview=function(e,t,i,s,a,n,r,o){var d={id:t,body:i};s&&(d.overall=s),a&&(d.animation=a),n&&(d.music=n),r&&(d.story=r),o&&(d.character=o),m(e,l,d)},this.createRecord=function(e,t,i,s){var a={id:t};i&&(a.rating=i),s&&(a.comment=s),m(e,c,a)},this.updateStatus=function(e,t,i){m(e,u,{id:t,state:i})},this.searchWorks=function(e,t,a,n){var r=t.split(s);if(0!=r.length&&r[0]){var o={titles:r,before:a,after:n};a?o.last=i:o.first=i,m(e,g,o)}else headerContent.inform("タイトルを入力してください。","danger")},this.request=m,this.makeWorkPageUrl=h,this.makeEpisodePageUrl=f},TitleNormalizer=$.extend(function(e){this.work=e,this.normalize()}.prototype,{katakanaRegExp:/[ァ-ヶ]/g,altRegExp:/^ゔ[ぁぃぅぇぉ]?/,altHash:{"ゔぁ":"ば","ゔぃ":"び","ゔ":"ぶ","ゔぅ":"ぶ","ゔぇ":"べ","ゔぉ":"ぼ"},normalize:function(){this.work.titleKana||(this.work.titleKana=this.work.title.replace(this.katakanaRegExp,this.toHiragana)),this.work.titleKana=this.work.titleKana.replace(this.altRegExp,this.alternate.bind(this))},toHiragana:function(e){var t=e.charCodeAt(0)-96;return String.fromCharCode(t)},alternate:function(e){return this.altHash[e]},getKana:function(){return this.work.titleKana},compare:function(e){var t=this.getKana(),i=e.getKana();return t<i?-1:t>i?1:0}}).constructor;
//# sourceMappingURL=annict.min.js.map